@use "./base.scss";
@use "./themes";
@use "./variables.scss" as *;

$page-title-font-size: 2.5rem;
$page-title-line-height: 1.2;
$sidebar-gap-desktop: 1.2rem;
$page-title-margin-top: -3.5rem;

// put your custom CSS here!

// Override fonts to use LXGW WenKai GB Screen as primary font - Target specific selectors
body,
div#quartz-root.page,
div#quartz-root.page body,
body p,
body a,
body a.internal,
body a.external,
body div:not(.highlight):not(pre),
body li,
body ul,
body ol,
.explorer,
.explorer *:not(code):not(pre):not(kbd):not(samp),
.content,
.content p,
.content a,
.content div:not(.highlight):not(pre):not(.breadcrumb-container),
.content li {
  font-family: "LXGW WenKai GB Screen", "Noto Sans SC", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif !important;
  // font-size: 1.08rem;  // Commented out - too broad, overrides many components
  line-height: 1.7;
}

h1,
h2,
h3,
h4,
h5,
h6 {
  font-family: "LXGW WenKai GB Screen", "Noto Sans SC", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif !important;
}

// Fix: Links inside headings should inherit heading font size and line height
h1 a,
h2 a,
h3 a,
h4 a,
h5 a,
h6 a {
  font-size: inherit !important;
  line-height: inherit !important;
}

// Use Fira Code for all code-related elements - Ultra strong overrides
* code,
* pre,
* kbd,
* samp,
html code,
html pre,
html kbd,
html samp,
body code,
body pre,
body kbd,
body samp,
:root code,
:root pre,
:root kbd,
:root samp,
:root body code,
:root body pre,
:root body kbd,
:root body samp,
.highlight code,
.highlight pre,
pre > code,
pre:has(> code),
:root pre > code,
:root pre:has(> code),
article code,
article pre,
.popover-hint code,
.popover-hint pre,
div code,
div pre,
p code,
p pre,
code[data-theme*=" "],
pre code[data-theme*=" "] {
  font-family: "Fira Code", "JetBrains Mono", "Monaco", "Menlo", "Consolas", monospace !important;
}

// Cursor pointer for interactive elements
.edit-btn,
.explorer button,
.explorer summary,
.explorer .folder-outer > .folder-title,
.explorer .file-list li,
.explorer-ul li,
.explorer-ul li a,
.explorer .folder-button,
.explorer .folder-title {
  cursor: pointer !important;
}

// Fix flex-component (3 icons) to top-right corner on all devices
.page > #quartz-body .sidebar.left > .flex-component {
  position: fixed !important;
  right: 2rem !important;
  top: 2rem !important;
  display: flex !important;
  justify-content: flex-end !important;
  pointer-events: none !important;
  z-index: 100 !important;

  > * {
    pointer-events: auto !important;
  }
}

// Position icons next to Explorer button (desktop only)
@media all and not ($mobile) {
  .page > #quartz-body .sidebar.left {
    display: flex !important;
    flex-direction: column !important;
    gap: 0 !important;

    > .explorer {
      position: relative !important;
      z-index: 5 !important;

      > .explorer-content {
        z-index: 1 !important;
        position: relative !important;
      }
    }
  }
}

// Align flex container items
.flex-component {
  align-items: center !important;

  & > div {
    display: flex !important;
    align-items: center !important;
  }
}

// Remove search button border and padding to align with other icons
.search > .search-button {
  background-color: transparent !important;
  box-shadow: none !important;
  border: none !important;
  border-radius: 0 !important;
  padding: 0 !important;
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;

  svg {
    margin: 0 !important;
    display: block !important;
  }
}

// Increase PageTitle (BYHEAVEN) font size and move up
.page-title {
  font-size: $page-title-font-size !important;
  line-height: $page-title-line-height;
  font-weight: 600 !important;
  margin-top: $page-title-margin-top !important;
  margin-bottom: 0 !important;
}

.page-title > a {
  font-size: inherit !important;
  line-height: inherit;
}

// Mobile: Reset PageTitle margin to prevent going off screen
@media #{$mobile} {
  // Create two-row layout: Row 1 (Explorer left + PageTitle right), Row 2 (Socials)
  .page > #quartz-body .sidebar.left {
    display: flex !important;
    flex-direction: row !important;
    flex-wrap: wrap !important;
    align-items: center !important;
  }

  // Row 1: Explorer on the left
  .page > #quartz-body .sidebar.left > .explorer {
    order: 1 !important;
    width: auto !important;
    flex-shrink: 0 !important;
    margin-right: 1rem !important;
  }

  // Row 1: PageTitle on the right (takes remaining space)
  .page > #quartz-body .sidebar.left > .page-title {
    order: 2 !important;
    flex: 1 !important;
    margin-top: 0 !important;
    margin-bottom: 0 !important;
    max-width: calc(100% - 200px) !important; // Prevent overlap with fixed icons (Explorer + icons space)
    font-size: clamp(1.2rem, 5vw, 2.5rem) !important; // Responsive font size that scales with viewport
    line-height: 1.3 !important;
  }

  .page > #quartz-body .sidebar.left > .page-title > a {
    font-size: inherit !important;
    line-height: inherit !important;
  }

  // Row 2: Socials on its own line, aligned with PageTitle
  .page > #quartz-body .sidebar.left > .socials {
    order: 3 !important;
    width: 100% !important;
    margin-top: 0 !important;
    margin-bottom: 0 !important;
    margin-left: calc(34px + 1rem) !important; // Explorer width + margin-right
  }

  // Hide mobile spacer
  .page > #quartz-body .sidebar.left > .spacer {
    display: none !important;
  }
}

// Add spacing after mobile spacer and before Explorer
@media all and not ($mobile) {
  .page > #quartz-body .sidebar.left > .spacer {
    margin-bottom: $sidebar-gap-desktop !important;
  }

  .page > #quartz-body .sidebar.left > .explorer {
    margin-top: $sidebar-gap-desktop !important;
  }
}

// Adjust Edit page and View history links
a.edit-btn {
  font-size: 0.85rem !important;
  opacity: 0.6 !important;

  &:hover {
    opacity: 0.8 !important;
  }
}

// Hide HR in page-footer (we'll add HR-style border to comments instead)
.page-footer > hr {
  display: none;
}

// Add spacing before comment section and ensure comments stay at bottom for short articles
.giscus,
.waline {
  // Use max() to ensure either 4rem spacing OR enough to push comments to bottom
  // 100vh (viewport) - 250px (estimated header + nav + footer) = min position for comments
  margin-top: max(4rem, calc(100vh - 250px)) !important;
  padding-top: 2.5rem !important;
  padding-bottom: 4rem !important;
  position: relative;

  // Gradient divider before comments
  &::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 2px;
    background: linear-gradient(to right, transparent, var(--gray) 20%, var(--gray) 80%, transparent);
  }

  // Desktop: show divider after comments
  @media all and not ($mobile) {
    border-bottom: 1px solid var(--light) !important;
  }
}

// Mobile: Add dotted divider line above Backlinks (only shows if backlinks exist)
@media #{$mobile} {
  .mobile-only.toc {
    display: flex !important;
    flex-direction: column !important;
    border-bottom: 1px dotted var(--lightgray) !important;
  }

  .mobile-only.backlinks {
    border-top: 1px dotted var(--lightgray) !important;
    padding-top: 2rem !important;
    margin-top: 3rem !important;
    margin-bottom: 2rem !important;
  }

  // Only show comment top divider when backlinks exist
  .mobile-only.backlinks ~ .giscus,
  .mobile-only.backlinks ~ .waline {
    border-top: 1px solid var(--lightgray) !important;
  }

  // Always show comment bottom divider on mobile
  .giscus,
  .waline {
    border-bottom: 1px solid var(--light) !important;
  }
}

// Increase font size for article body content only (not headings, not sidebar components)
article p,
article li,
article td,
article blockquote,
article a:not(h1 a):not(h2 a):not(h3 a):not(h4 a):not(h5 a):not(h6 a) {
  font-size: 1.1rem !important;
}

// Reduce font size for footer and comment system credits
footer,
footer *,
.giscus-frame {
  font-size: 0.75rem !important;
}

// Hide Waline powered by text
.wl-power {
  display: none !important;
}
